import random
import sqlite3
from aiogram import types
from db import get_user
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton

# ðŸŽ° Ð¡Ð»Ð¾Ñ‚-Ð¼Ð°ÑˆÐ¸Ð½Ð°
async def slot_machine(msg: types.Message):
    get_user(msg.from_user.id, msg.from_user.username)
    conn = sqlite3.connect("users.db")
    cur = conn.cursor()
    cur.execute("SELECT balance FROM users WHERE id=?", (msg.from_user.id,))
    balance = cur.fetchone()[0]
    if balance >= 100:
        symbols = ["ðŸ’", "ðŸ’Ž", "ðŸ””", "ðŸ‹"]
        roll = [random.choice(symbols) for _ in range(3)]
        result = " | ".join(roll)
        reward = 300 if roll[0] == roll[1] == roll[2] else 0
        cur.execute("UPDATE users SET balance=balance-100, crystals=crystals+? WHERE id=?", (reward, msg.from_user.id))
        conn.commit()
        await msg.answer(f"ðŸŽ° {result}\n{'Ð’Ñ‹ Ð²Ñ‹Ð¸Ð³Ñ€Ð°Ð»Ð¸ 300 ðŸ’Ž!' if reward else 'ÐÐµ Ð¿Ð¾Ð²ÐµÐ·Ð»Ð¾.'}")
    else:
        await msg.answer("âŒ ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑÑ€ÐµÐ´ÑÑ‚Ð².")
    conn.close()

# ðŸŽ¯ ÐšÐ¾Ð»ÐµÑÐ¾ ÑƒÐ´Ð°Ñ‡Ð¸
async def wheel_of_fortune(msg: types.Message):
    get_user(msg.from_user.id, msg.from_user.username)
    prizes = ["ðŸ’Ž 100", "ðŸ§  1", "ðŸ’Ž 50", "ÐŸÑƒÑÑ‚Ð¾", "ðŸ’Ž 200"]
    conn = sqlite3.connect("users.db")
    cur = conn.cursor()
    cur.execute("SELECT balance FROM users WHERE id=?", (msg.from_user.id,))
    balance = cur.fetchone()[0]
    if balance >= 50:
        prize = random.choice(prizes)
        cur.execute("UPDATE users SET balance=balance-50 WHERE id=?", (msg.from_user.id,))
        if "ðŸ’Ž" in prize:
            amount = int(prize.split()[1])
            cur.execute("UPDATE users SET crystals=crystals+? WHERE id=?", (amount, msg.from_user.id))
        elif "ðŸ§ " in prize:
            cur.execute("INSERT INTO inventory (user_id, brainrot) VALUES (?, ?)", (msg.from_user.id, "Corn Corn Corn"))
        conn.commit()
        await msg.answer(f"ðŸŽ¯ ÐšÐ¾Ð»ÐµÑÐ¾ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ð»Ð¾ÑÑŒ: {prize}")
    else:
        await msg.answer("âŒ ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑÑ€ÐµÐ´ÑÑ‚Ð².")
    conn.close()

# ðŸŽ² ÐšÐ¾ÑÑ‚Ð¸
async def dice_game(msg: types.Message):
    get_user(msg.from_user.id, msg.from_user.username)
    conn = sqlite3.connect("users.db")
    cur = conn.cursor()
    cur.execute("SELECT balance FROM users WHERE id=?", (msg.from_user.id,))
    balance = cur.fetchone()[0]
    if balance >= 100:
        roll = random.randint(1, 6)
        reward = 500 if roll == 6 else 0
        cur.execute("UPDATE users SET balance=balance-100, crystals=crystals+? WHERE id=?", (reward, msg.from_user.id))
        conn.commit()
        await msg.answer(f"ðŸŽ² Ð’Ñ‹Ð¿Ð°Ð»Ð¾: {roll}\n{'Ð’Ñ‹ Ð²Ñ‹Ð¸Ð³Ñ€Ð°Ð»Ð¸ 500 ðŸ’Ž!' if reward else 'ÐÐµ Ð¿Ð¾Ð²ÐµÐ·Ð»Ð¾.'}")
    else:
        await msg.answer("âŒ ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑÑ€ÐµÐ´ÑÑ‚Ð².")
    conn.close()

# ðŸ§ª ÐÐ»Ñ…Ð¸Ð¼Ð¸Ñ
async def crystal_alchemy(msg: types.Message):
    get_user(msg.from_user.id, msg.from_user.username)
    conn = sqlite3.connect("users.db")
    cur = conn.cursor()
    cur.execute("SELECT COUNT(*) FROM inventory WHERE user_id=?", (msg.from_user.id,))
    br = cur.fetchone()[0]
    if br >= 1:
        reward = random.choice([0, 100, 250, 500, 1000])
        cur.execute("DELETE FROM inventory WHERE user_id=? LIMIT 1", (msg.from_user.id,))
        cur.execute("UPDATE users SET crystals=crystals+? WHERE id=?", (reward, msg.from_user.id))
        conn.commit()
        await msg.answer(f"ðŸ§ª ÐÐ»Ñ…Ð¸Ð¼Ð¸Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°!\n{'Ð’Ñ‹ ÑÐ¾Ð·Ð´Ð°Ð»Ð¸ ÐºÑ€Ð¸ÑÑ‚Ð°Ð»Ð» Ð½Ð° ' + str(reward) + ' ðŸ’Ž!' if reward else 'ÐÐµÑƒÐ´Ð°Ñ‡Ð°, Ð‘Ñ€ÐµÐ¹Ð½Ñ€Ð¾Ñ‚ Ð¸ÑÑ‡ÐµÐ·.'}")
    else:
        await msg.answer("âŒ Ð£ Ð²Ð°Ñ Ð½ÐµÑ‚ Ð‘Ñ€ÐµÐ¹Ð½Ñ€Ð¾Ñ‚Ð¾Ð².")
    conn.close()

# ðŸ’£ ÐœÐ¸Ð½Ð° Ð¸Ð»Ð¸ ÐºÑ€Ð¸ÑÑ‚Ð°Ð»Ð»
async def mine_game(msg: types.Message):
    get_user(msg.from_user.id, msg.from_user.username)
    conn = sqlite3.connect("users.db")
    cur = conn.cursor()
    cur.execute("SELECT balance FROM users WHERE id=?", (msg.from_user.id,))
    balance = cur.fetchone()[0]
    if balance >= 50:
        cur.execute("UPDATE users SET balance=balance-50 WHERE id=?", (msg.from_user.id,))
        conn.commit()
        kb = InlineKeyboardMarkup()
        for i in range(1, 4):
            kb.add(InlineKeyboardButton(f"Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ {i}", callback_data=f"mine_{i}"))
        await msg.answer("ðŸ’£ Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ð¾Ð´Ð½Ñƒ Ð¸Ð· Ñ‚Ñ€Ñ‘Ñ… ÐºÐ½Ð¾Ð¿Ð¾Ðº. Ð”Ð²Ðµ â€” ÐºÑ€Ð¸ÑÑ‚Ð°Ð»Ð»Ñ‹, Ð¾Ð´Ð½Ð° â€” Ð¼Ð¸Ð½Ð°.", reply_markup=kb)
    else:
        await msg.answer("âŒ ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑÑ€ÐµÐ´ÑÑ‚Ð².")
    conn.close()

async def mine_result(call: types.CallbackQuery):
    choice = int(call.data.split("_")[1])
    result = random.choice(["ðŸ’Ž", "ðŸ’Ž", "ðŸ’£"])
    conn = sqlite3.connect("users.db")
    cur = conn.cursor()
    if result == "ðŸ’Ž":
        cur.execute("UPDATE users SET crystals=crystals+100 WHERE id=?", (call.from_user.id,))
        await call.message.answer("ðŸ’Ž Ð’Ñ‹ Ð½Ð°ÑˆÐ»Ð¸ ÐºÑ€Ð¸ÑÑ‚Ð°Ð»Ð»! +100")
    else:
        await call.message.answer("ðŸ’£ Ð‘Ð°Ñ…! ÐœÐ¸Ð½Ð°. ÐÐ¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¾.")
    conn.commit()
    conn.close()

# ðŸ§  Ð‘Ñ€ÐµÐ¹Ð½Ñ€Ð¾Ñ‚-Ð»Ð¾Ñ‚ÐµÑ€ÐµÑ
async def brainrot_lottery(msg: types.Message):
    get_user(msg.from_user.id, msg.from_user.username)
    conn = sqlite3.connect("users.db")
    cur = conn.cursor()
    cur.execute("SELECT balance FROM users WHERE id=?", (msg.from_user.id,))
    balance = cur.fetchone()[0]
    if balance >= 200:
        cur.execute("UPDATE users SET balance=balance-200 WHERE id=?", (msg.from_user.id,))
        roll = random.randint(1, 100)
        if roll <= 5:
            name = "Noobini"
        elif roll <= 20:
            name = "Turbo 4000"
        elif roll <= 50:
            name = "Sigma Girl"
        else:
            name = "Corn Corn Corn"
        cur.execute("INSERT INTO inventory (user_id, brainrot) VALUES (?, ?)", (msg.from_user.id, name))
        conn.commit()
        await msg.answer(f"ðŸ§  Ð’Ñ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð»Ð¸: {name}")
    else:
        await msg.answer("âŒ ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑÑ€ÐµÐ´ÑÑ‚Ð².")
    conn.close()

# ðŸ’Ž ÐšÑ€Ð¸ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÐšÐ²ÐµÑÑ‚
async def crystal_quest(msg: types.Message):
    get_user(msg.from_user.id, msg.from_user.username)
    conn = sqlite3.connect("users.db")
    cur = conn.cursor()
    cur.execute("SELECT balance FROM users WHERE id=?", (msg.from_user.id,))
    balance = cur.fetchone()[0]
    if balance >= 150:
        reward = random.randint(50, 500)
        cur.execute("UPDATE users SET balance=balance-150, crystals=crystals+? WHERE id=?", (reward, msg.from_user.id))
        conn.commit()
        await msg.answer(f"ðŸ’Ž Ð’Ñ‹ Ð½Ð°ÑˆÐ»Ð¸ {reward} ÐºÑ€Ð¸ÑÑ‚Ð°Ð»Ð»Ð¾Ð²!")
    else:
        await msg.answer("âŒ ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑÑ€ÐµÐ´ÑÑ‚Ð².")
    conn.close()

# ðŸ§¬ Ð­Ð²Ð¾Ð»ÑŽÑ†Ð¸Ñ Ð‘Ñ€ÐµÐ¹Ð½Ñ€Ð¾Ñ‚Ð°
async def evolve_brainrot(msg: types.Message):
    get_user(msg.from_user.id, msg.from_user.username)
    conn = sqlite3.connect("users.db")
    cur = conn.cursor()
    cur.execute("SELECT COUNT(*) FROM inventory WHERE user_id=?", (msg.from_user.id,))
    count = cur.fetchone()[0]
    if count >= 2:
        cur.execute("DELETE FROM inventory WHERE user_id=? LIMIT 2", (msg.from_user.id,))
        new_brainrot = random.choice(["Sigma Girl", "Turbo 4000", "Noobini"])
        cur.execute("INSERT INTO inventory (user_id, brainrot) VALUES (?, ?)", (msg.from_user.id, new_brainrot))
        conn